{% extends 'base.html' %}
{% block titulo %}Login{% endblock %}
{% block contenido %}

<!-- CONTENEDOR PRINCIPAL -->
<div class="container-fluid vh-100 d-flex justify-content-center align-items-center position-relative" 
     style="overflow: hidden;">

  <!-- Fondo animado -->
  <div id="background-animation"></div>

  <div class="card shadow-lg border-0 glass-card animate__animated animate__fadeIn" 
       style="border-radius: 1rem; max-width: 900px; width: 100%; z-index: 10;">
    <div class="row g-0">

      <!-- PANEL IZQUIERDO -->
      <div class="col-md-5 d-none d-md-flex flex-column justify-content-center align-items-center text-white" 
           style="background: linear-gradient(135deg, #6a11cb, #2575fc); border-radius: 1rem 0 0 1rem;">
        <i class="bi bi-person-circle display-1 mb-3" style="text-shadow: 0 5px 15px rgba(0,0,0,0.3);"></i>
        <h2 class="fw-bold">隆Bienvenido!</h2>
        <p class="text-light text-center px-3">Accede a tu cuenta o crea una nueva para descubrir m谩s.</p>
        <a href="{{ url_for('Registro') }}" class="btn btn-light fw-bold btn-lg shadow-sm mt-2"
           style="border-radius: 50px; transition: 0.3s;"
           onmouseover="this.style.transform='scale(1.05)'"
           onmouseout="this.style.transform='scale(1)'">
          <i class="bi bi-person-plus-fill me-2"></i>Registrarse
        </a>
      </div>

      <!-- PANEL DERECHO -->
      <div class="col-md-7 bg-white bg-opacity-75 p-5 rounded-end position-relative">
        <h2 class="fw-bold mb-4 text-center text-gradient">
          <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesi贸n
        </h2>

        <!-- Bot贸n Google -->
        <div class="d-grid mb-3">
          <button type="button" class="btn btn-outline-dark btn-google d-flex align-items-center justify-content-center shadow-sm">
            <i class="bi bi-google fs-4 me-2"></i> Iniciar sesi贸n con Google
          </button>
        </div>

        <p class="text-center fw-bold text-muted my-3">o usa tu correo electr贸nico</p>

        <form id="loginForm" action="{{ url_for('accesologin') }}" method="POST" novalidate>
          <div class="form-floating mb-3 position-relative" data-bs-toggle="tooltip" data-bs-placement="top" title="Ingresa tu correo electr贸nico v谩lido">
            <input type="email" class="form-control input-modern" id="floatingEmail" name="email" placeholder="Correo" required>
            <label for="floatingEmail"><i class="bi bi-envelope-fill me-2"></i>Correo electr贸nico</label>
            <i class="bi bi-check-circle-fill valid-icon text-success position-absolute end-0 top-50 translate-middle-y me-3 d-none"></i>
          </div>

          <div class="form-floating mb-4 position-relative" data-bs-toggle="tooltip" data-bs-placement="top" title="Ingresa tu contrase帽a correctamente">
            <input type="password" class="form-control input-modern" id="floatingPassword" name="password" placeholder="Contrase帽a" required>
            <label for="floatingPassword"><i class="bi bi-lock-fill me-2"></i>Contrase帽a</label>
            <i class="bi bi-check-circle-fill valid-icon text-success position-absolute end-0 top-50 translate-middle-y me-3 d-none"></i>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-gradient fw-bold btn-lg shadow-sm">
              <i class="bi bi-box-arrow-in-right me-2"></i>Entrar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ESTILOS -->
<style>
#background-animation {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(270deg, #74ebd5, #ACB6E5, #6a11cb, #2575fc);
  background-size: 800% 800%;
  animation: gradientBG 15s ease infinite;
  filter: blur(40px);
  z-index: -1;
}
@keyframes gradientBG {
  0% {background-position: 0% 50%;}
  50% {background-position: 100% 50%;}
  100% {background-position: 0% 50%;}
}
.glass-card {
  backdrop-filter: blur(12px);
  background: rgba(255, 255, 255, 0.7);
  transition: 0.4s ease-in-out;
}
.glass-card:hover {
  transform: scale(1.02);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}
.text-gradient {
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.btn-gradient {
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  color: white;
  border: none;
  border-radius: 50px;
  transition: 0.3s;
}
.btn-gradient:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 18px rgba(106,17,203,0.4);
}
.input-modern {
  border-radius: 0.75rem;
  transition: all 0.3s ease;
}
.input-modern:focus {
  border-color: #6a11cb;
  box-shadow: 0 0 8px rgba(106,17,203,0.3);
}
.is-invalid {
  border-color: #dc3545 !important;
  box-shadow: 0 0 6px rgba(220,53,69,0.3);
}
.shake {
  animation: shake 0.4s;
}
@keyframes shake {
  0%,100%{transform:translateX(0);}
  25%{transform:translateX(-4px);}
  50%{transform:translateX(4px);}
  75%{transform:translateX(-4px);}
}
.valid-icon {
  pointer-events: none;
  font-size: 1.25rem;
  top: 50%;
  transform: translateY(-50%);
}
</style>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // Inicializa tooltips Bootstrap
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })

  const form = document.getElementById('loginForm');
  const inputs = form.querySelectorAll('.form-control');

  inputs.forEach(input => {
    const icon = input.parentElement.querySelector('.valid-icon');
    input.addEventListener('input', () => {
      if (input.value.trim() !== '') {
        input.classList.remove('is-invalid');
        icon.classList.remove('d-none');
      } else {
        icon.classList.add('d-none');
      }
    });
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    let valid = true;

    inputs.forEach(input => {
      const icon = input.parentElement.querySelector('.valid-icon');
      if (!input.value.trim()) {
        valid = false;
        input.classList.add('is-invalid', 'shake');
        icon.classList.add('d-none');
        const tooltip = bootstrap.Tooltip.getInstance(input) || new bootstrap.Tooltip(input);
        tooltip.show();
        setTimeout(() => {
          tooltip.hide();
          input.classList.remove('shake');
        }, 1200);
      }
    });

    if (!valid) {
      Swal.fire({
        icon: 'warning',
        title: 'Campos vac铆os',
        text: 'Por favor, completa todos los campos antes de continuar.',
        confirmButtonColor: '#6a11cb',
        background: '#fff',
        showClass: { popup: 'animate__animated animate__shakeX' },
        backdrop: `
          rgba(0,0,123,0.4)
          url("https://media.giphy.com/media/MaI6BylfjAkDk/giphy.gif")
          left top
          no-repeat
        `
      });
      return;
    }

    // Simulaci贸n de 茅xito antes de submit real
    Swal.fire({
      icon: 'success',
      title: '隆Bienvenido!',
      text: 'Inicio de sesi贸n exitoso ',
      confirmButtonColor: '#2575fc',
      timer: 1800,
      showConfirmButton: false
    }).then(() => form.submit());
  });
</script>

{% if ya_logueado %}
<script>
  Swal.fire({
    icon: 'info',
    title: 'Ya has iniciado sesi贸n',
    text: 'No es necesario iniciar sesi贸n de nuevo.',
    confirmButtonColor: '#2575fc',
    timer: 2500,
    showConfirmButton: false
  });
</script>
{% endif %}

{% endblock %}
