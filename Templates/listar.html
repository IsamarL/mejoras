{% extends 'baseadmin.html' %}

{% block title %}Lista de Usuarios{% endblock %}

{% block body %}

<!-- ALERTAS CON SWEETALERT2 -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <script>
        Swal.fire({
          toast: true,
          position: 'top-end',
          icon: '{{ category }}',
          title: '{{ message }}',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        });
      </script>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- CONFIRMACIÓN PARA ELIMINAR -->
<script>
  function confirmarEliminacion(url) {
    Swal.fire({
      title: '¿Estás segura?',
      text: '¡No podrás revertir esto!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Sí, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

<div class="container p-5 mt-3">
  <div class="card">
    <div class="card-body shadow-lg rounded" style="background: linear-gradient(220deg, #ffffff,#7a9f7a,#355e3b);">
      <button type="button" class="btn btn-outline-success float-end" data-bs-toggle="modal" data-bs-target="#modalAgregar">
        Agregar Usuario
      </button>

      <!-- MODAL AGREGAR USUARIO -->
      <div class="modal fade" id="modalAgregar" tabindex="-1" aria-labelledby="modalAgregarLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <form action="{{ url_for('guardar') }}" method="POST">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="modalAgregarLabel">Registro de Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div class="form-floating mb-2">
                  <input type="text" class="form-control" name="nombre" placeholder="Nombre completo" required>
                  <label>Nombre completo</label>
                </div>
                <div class="form-floating mb-2">
                  <input type="email" class="form-control" name="email" placeholder="Correo electrónico" required>
                  <label>Correo electrónico</label>
                </div>
                <div class="form-floating mb-2">
                  <input type="text" class="form-control" name="password" placeholder="Contraseña" required>
                  <label>Contraseña</label>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% if usuarios %}
    <h2 class="text-center mt-4">Lista de Usuarios</h2>
    <table class="table table-hover table-striped">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Contraseña</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for mostrar in usuarios %}
        <tr>
          <td>{{ mostrar.id }}</td>
          <td>{{ mostrar.nombre }}</td>
          <td>{{ mostrar.email }}</td>
          <td>{{ mostrar.password }}</td>
          <td>
            <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modaledit{{ mostrar.id }}">Editar</button>
            <button class="btn btn-danger btn-sm" onclick="confirmarEliminacion('{{ url_for('borrarUser', id=mostrar.id) }}')">Eliminar</button>
          </td>
        </tr>

        <!-- MODAL EDITAR USUARIO -->
        <div class="modal fade" id="modaledit{{ mostrar.id }}" tabindex="-1" aria-labelledby="modalEditLabel{{ mostrar.id }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <form action="{{ url_for('updateUsuario') }}" method="POST">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title" id="modalEditLabel{{ mostrar.id }}">Editar Usuario</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" name="id" value="{{ mostrar.id }}">
                  <div class="form-group mb-2">
                    <label>Nombre</label>
                    <input type="text" class="form-control" name="nombre" value="{{ mostrar.nombre }}" required>
                  </div>
                  <div class="form-group mb-2">
                    <label>Correo</label>
                    <input type="email" class="form-control" name="email" value="{{ mostrar.email }}" required>
                  </div>
                  <div class="form-group mb-2">
                    <label>Contraseña</label>
                    <input type="text" class="form-control" name="password" value="{{ mostrar.password }}" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-primary">Actualizar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-center mt-4">No hay usuarios registrados.</p>
  {% endif %}
</div>

{% endblock %}