{% extends 'baseadmin.html' %}

{% block title %}Lista de Usuarios{% endblock %}

{% block body %}

<!-- ALERTAS CON SWEETALERT2 -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <script>
        Swal.fire({
          toast: true,
          position: 'top-end',
          icon: '{{ category }}',
          title: '{{ message }}',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        });
      </script>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- CONFIRMACIÓN PARA ELIMINAR -->
<script>
  function confirmarEliminacion(url) {
    Swal.fire({
      title: '¿Estás segura?',
      text: '¡No podrás revertir esto!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Sí, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

<div class="container py-5">

  <!-- Botón Agregar Usuario -->
  <div class="d-flex justify-content-end mb-4">
    <button type="button" class="btn btn-gradient-success btn-lg" data-bs-toggle="modal" data-bs-target="#modalAgregar">
      <i class="bi bi-person-plus-fill me-2"></i>Agregar Usuario
    </button>
  </div>

  <!-- MODAL AGREGAR USUARIO -->
  <div class="modal fade" id="modalAgregar" tabindex="-1" aria-labelledby="modalAgregarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form action="{{ url_for('guardar') }}" method="POST">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="modalAgregarLabel">Registro de Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="form-floating mb-3">
              <input type="text" class="form-control" name="nombre" placeholder="Nombre completo" required>
              <label>Nombre completo</label>
            </div>
            <div class="form-floating mb-3">
              <input type="email" class="form-control" name="email" placeholder="Correo electrónico" required>
              <label>Correo electrónico</label>
            </div>
            <div class="form-floating mb-3">
              <input type="text" class="form-control" name="password" placeholder="Contraseña" required>
              <label>Contraseña</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-gradient-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% if usuarios %}
    <div class="row g-4">
      {% for mostrar in usuarios %}
        <div class="col-md-6 col-lg-4">
          <div class="card shadow-lg card-user">
            <div class="card-body">
              <h5 class="card-title text-center text-primary fw-bold">{{ mostrar.nombre }}</h5>
              <p class="text-center text-muted"><i class="bi bi-envelope-fill me-1"></i>{{ mostrar.email }}</p>
              <p class="text-center text-muted"><i class="bi bi-key-fill me-1"></i>{{ mostrar.password }}</p>

              <div class="d-flex justify-content-around mt-3">
                <button class="btn btn-gradient-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modaledit{{ mostrar.id }}">
                  <i class="bi bi-pencil-square me-1"></i>Editar
                </button>
                <button class="btn btn-gradient-danger btn-sm" onclick="confirmarEliminacion('{{ url_for('borrarUser', id=mostrar.id) }}')">
                  <i class="bi bi-trash-fill me-1"></i>Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- MODAL EDITAR USUARIO -->
        <div class="modal fade" id="modaledit{{ mostrar.id }}" tabindex="-1" aria-labelledby="modalEditLabel{{ mostrar.id }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <form action="{{ url_for('updateUsuario') }}" method="POST">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title" id="modalEditLabel{{ mostrar.id }}">Editar Usuario</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" name="id" value="{{ mostrar.id }}">
                  <div class="form-group mb-3">
                    <label>Nombre</label>
                    <input type="text" class="form-control" name="nombre" value="{{ mostrar.nombre }}" required>
                  </div>
                  <div class="form-group mb-3">
                    <label>Correo</label>
                    <input type="email" class="form-control" name="email" value="{{ mostrar.email }}" required>
                  </div>
                  <div class="form-group mb-3">
                    <label>Contraseña</label>
                    <input type="text" class="form-control" name="password" value="{{ mostrar.password }}" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-gradient-primary">Actualizar</button>
                </div>
              </form>
            </div>
          </div>
        </div>

      {% endfor %}
    </div>
  {% else %}
    <p class="text-center mt-4 text-white fs-5">No hay usuarios registrados.</p>
  {% endif %}

</div>

<!-- ESTILOS MODERNOS -->
<style>
.card-user {
  border-radius: 15px;
  background: linear-gradient(145deg, #e0f7fa, #b2ebf2);
  transition: transform 0.3s, box-shadow 0.3s;
}
.card-user:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 30px rgba(0,0,0,0.3);
}

.btn-gradient-success {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: white;
  transition: all 0.3s ease;
}
.btn-gradient-success:hover { transform: translateY(-3px) scale(1.05); }

.btn-gradient-primary {
  background: linear-gradient(135deg, #2196f3, #64b5f6);
  color: white;
  transition: all 0.3s ease;
}
.btn-gradient-primary:hover { transform: translateY(-3px) scale(1.05); }

.btn-gradient-danger {
  background: linear-gradient(135deg, #f44336, #e57373);
  color: white;
  transition: all 0.3s ease;
}
.btn-gradient-danger:hover { transform: translateY(-3px) scale(1.05); }

.btn-gradient-success:active,
.btn-gradient-primary:active,
.btn-gradient-danger:active {
  transform: scale(0.95);
}
</style>

{% endblock %}
