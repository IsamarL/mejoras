{% extends 'base.html' %}

{% block titulo %} REGISTRO {% endblock %}

{% block contenido %}
<style>
  /* Animación para degradado de fondo principal (fondo rosa) */
  @keyframes gradientAnimationMain {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  .animated-bg-main {
    background: linear-gradient(270deg, #ff9a9e, #fbc2eb, #fad0c4, #f6d365);
    background-size: 800% 800%;
    animation: gradientAnimationMain 20s ease infinite;
  }

  /* Animación para degradado de fondo panel izquierdo */
  @keyframes gradientAnimationLeft {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  .animated-bg-left {
    background: linear-gradient(270deg, #764ba2, #667eea, #89f7fe, #66a6ff);
    background-size: 800% 800%;
    animation: gradientAnimationLeft 15s ease infinite;
  }

  /* Contenedor del texto dentro del círculo */
  .circle-container {
    position: relative;
  }

  .welcome-text {
    position: absolute;
    top: 0; bottom: 0; left: 0; right: 0;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .form-control:focus, .form-select:focus {
      border-color: #a18cd1;
      box-shadow: 0 0 0 0.25rem rgba(161,140,209,0.25);
  }
  .is-invalid {
      border-color: #ff3f3f !important;
      box-shadow: 0 0 8px rgba(255,63,63,0.6);
      transition: all 0.3s ease;
  }
  .is-valid {
      border-color: #a18cd1 !important;
      box-shadow: 0 0 8px rgba(161,140,209,0.3);
      transition: all 0.3s ease;
  }
  .btn-gradient {
      border-radius: 50px;
      transition: all 0.3s;
  }
  .btn-gradient:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }
</style>

<div class="container-fluid vh-100 animated-bg-main">
    <div class="container h-100 d-flex justify-content-center align-items-center">
        <div class="card shadow-lg rounded-4" style="width: 900px; max-width: 95%; overflow: hidden;">
            <div class="row g-0">

                <!-- Panel izquierdo decorativo con fondo animado -->
                <div class="col-md-6 d-none d-md-flex flex-column justify-content-center align-items-center text-center px-4 animated-bg-left" 
                     style="color: white; position: relative;">

                    <div class="circle-container position-relative mb-4" style="width: 250px; height: 250px;">
                        <img src="{{ url_for('static', filename='inicio.png') }}" 
                             class="img-fluid rounded-circle shadow-lg" 
                             style="width: 250px; height: 250px; object-fit: cover;">
                             
                        <!-- Texto centrado sobre el círculo -->
                        <div class="welcome-text d-flex justify-content-center align-items-center">
                            <h2 class="fw-bold mb-0" style="text-shadow: 2px 2px 6px rgba(0,0,0,0.7); font-size: 2.5rem;">
                                ¡Bienvenido!
                            </h2>
                        </div>
                    </div>

                    <p class="mb-4">Únete y descubre nuestras funcionalidades modernas y fáciles de usar.</p>
                    <a href="{{ url_for('login') }}" class="btn btn-outline-light btn-lg fw-bold shadow-sm">
                        Iniciar Sesión
                    </a>
                </div>

                <!-- Panel derecho (formulario) -->
                <div class="col-md-6 d-flex align-items-center" style="background-color: #fff;">
                    <div class="card-body p-5">
                        <h2 class="fw-bold text-center mb-4" style="color: #a18cd1;">Registro</h2>

                        <form id="registroForm" action="{{ url_for('Registro') }}" method="POST" novalidate>

                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Nombre completo" 
                                       data-bs-toggle="tooltip" data-bs-placement="top" title="Ingresa tu nombre completo">
                                <label for="nombre">Nombre completo</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="email" class="form-control" id="email" name="email" placeholder="Correo electrónico" 
                                       data-bs-toggle="tooltip" data-bs-placement="top" title="Ingresa un correo válido">
                                <label for="email">Correo electrónico</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" id="password" name="password" placeholder="Contraseña" 
                                       data-bs-toggle="tooltip" data-bs-placement="top" title="La contraseña debe tener al menos 6 caracteres">
                                <label for="password">Contraseña</label>
                            </div>

                            <div class="form-floating mb-3">
                                <select class="form-select" id="rol" name="id_rol" 
                                        data-bs-toggle="tooltip" data-bs-placement="top" title="Selecciona un rol">
                                    <option value="">Selecciona...</option>
                                    <option value="2">Cliente</option>
                                    <option value="1">Administrador</option>
                                </select>
                                <label for="rol">Selecciona tu rol</label>
                            </div>

                            <div class="d-grid mb-3">
                                <button type="submit" id="btnRegistro" class="btn btn-gradient btn-lg fw-bold shadow-sm" style="background: linear-gradient(135deg, #ff512f, #dd2476); color:white;">
                                    Registrarse
                                </button>
                            </div>
                        </form>

                        <p class="text-center text-muted mt-3">¿Ya tienes cuenta? <a href="{{ url_for('login') }}">Inicia sesión</a></p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Campos con mensajes personalizados
const campos = {
    nombre: "Ingresa tu nombre completo",
    email: "Ingresa un correo válido",
    password: "La contraseña debe tener al menos 6 caracteres",
    rol: "Selecciona un rol"
};

const btnRegistro = document.getElementById('btnRegistro');

// Inicializar tooltips y animaciones
Object.keys(campos).forEach(id => {
    const input = document.getElementById(id);
    const tooltip = new bootstrap.Tooltip(input, { trigger: 'manual', placement: 'top' });

    function mostrarError() {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
        tooltip.show();
    }

    function quitarError() {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        tooltip.hide();
    }

    input.addEventListener('mouseenter', () => { if(!input.value.trim()) mostrarError(); });
    input.addEventListener('mouseleave', () => tooltip.hide());
    input.addEventListener('input', () => { if(input.value.trim()) quitarError(); else mostrarError(); checkForm(); });
    input.addEventListener('blur', () => { if(!input.value.trim()) mostrarError(); else quitarError(); checkForm(); });
});

// Validación al enviar formulario
document.getElementById('registroForm').addEventListener('submit', function(e){
    let valid = true;
    Object.keys(campos).forEach(id => {
        const input = document.getElementById(id);
        if(!input.value.trim()){
            const tooltip = bootstrap.Tooltip.getInstance(input);
            tooltip.show();
            input.classList.add('is-invalid');
            valid = false;
        }
    });
    if(!valid){
        e.preventDefault();
        btnRegistro.style.background = 'linear-gradient(135deg, #ff6a6a, #ff3f3f)';
    }
});

// Cambiar color del botón según completitud
function checkForm(){
    const allFilled = Object.keys(campos).every(id => document.getElementById(id).value.trim() !== '');
    btnRegistro.style.background = allFilled ? 'linear-gradient(135deg, #ff512f, #dd2476)' : 'linear-gradient(135deg, #ff6a6a, #ff3f3f)';
}
</script>

{% endblock %}
